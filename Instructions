This set of instructions/code shows you how to modify CESM to allow dust to mobilize regardless of the model's vegetation. In CLM4, dust is not mobilized if a grid cell's leaf+stem area index exceeds 0.3. This setup will bypass that requirement and allow dust to mobilize according to a separate vegetational setup (case2).

Step 1: Define the two vegetational setups according to your needs. One (case1) will be the vegetation for the base simulation. Another (case2) will be the vegetation that the dust model uses when determining dust mobilization.
Step 2: Run each simulation (case1 and case2) for 12 months and create CLM restart files for each month (ex. case1.clm2.r.0001-02-01.nc).
Step 3: Create a file with the values for pgridcell (the grid cell for each pft value), such as pgridcell.dat (for 71148 pft values). This cannot be done with the default restart file. An easier way to find this is by looping through all pft values in a .F90 module in CLM4 and printing out the pgridcell values to the lnd.log file.
Step 4: Using the file "add_tlai_tsai_dust_variable_to_netcdf.ncl", fill in file paths for case1/case2 restart files and pgridcell file. This NCL script will create new variables "tlai_dust" and "tsai_dust" that are consistent with case2's tlai/tsai and insert them into case1's restart files. The script takes the total summed tlai/tsai per gridcell in case2 and applies it to every corresponding pft value for that grid cell in case1. Therefore, the pft weights do not need to change from case1, but the resulting tlai_dust/tsai_dust will mimic tlai/tsai in case2.
Step 5: Create your case in CESM and add the source code files ("clmtype.F90","clmtypeInitMod.F90","DUSTMod.F90","histFldsMod.F90") to the case directory "SourceMods/src.clm". Note: these files are compatible with the CESM model version "iCESM1_2_0_1_geotrace_n03" and will need to be modified for other versions. The changes that were made in each file are clearly marked, so they can be easily applied to other versions. 
Step 6: Run your CESM case1 and double-check tlai_dust/tsai_dust and DSTFLXT in your CLM history files to ensure that the code modifications are working correctly.
